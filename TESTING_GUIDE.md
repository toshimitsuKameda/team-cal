# テスト・動作確認ガイド

## ビルドと実行

### 1. 依存関係のインストール
```bash
npm install
```

### 2. ビルド
```bash
npm run build
```

### 3. Chrome拡張機能として読み込み
1. Chromeで `chrome://extensions/` を開く
2. 「デベロッパーモード」を有効化
3. 「パッケージ化されていない拡張機能を読み込む」をクリック
4. `dist` フォルダを選択

### 4. 権限の更新（重要）
今回のアップデートで、スコープが変更されました：
- 変更前: `calendar.readonly`
- 変更後: `calendar`（書き込み権限）

**対応が必要:**
1. 拡張機能をリロード
2. サイドパネルを開く
3. 再度ログインを求められます
4. 新しい権限を許可してください

## 機能テスト

### テスト1: 新しいUIの確認

**手順:**
1. サイドパネルを開く
2. ピル型のチーム選択UIが表示されることを確認
3. `+` ボタンと ⚙️ ボタンが表示されることを確認

**期待結果:**
- コンパクトなピル型UIが表示される
- ボタンが円形アイコンで表示される
- 横スクロールが機能する（チームが多い場合）

### テスト2: チーム作成

**手順:**
1. `+` ボタンをクリック
2. チーム名: 「テストチーム」
3. メンバー:
   ```
   user1@example.com,山田太郎
   user2@example.com,田中花子
   ```
4. 「保存」をクリック

**期待結果:**
- ピル型ボタンにチームが追加される
- メンバー数が表示される（例: `テストチーム 2`）

### テスト3: カレンダー同期

**手順:**
1. チームを作成（まだの場合）
2. チームのピルボタンをクリック
3. 「カレンダーを同期中...」メッセージを確認
4. Googleカレンダーを別タブで開く
5. 「他のカレンダー」セクションを確認

**期待結果:**
- 同期中メッセージが3-5秒表示される
- Googleカレンダーにメンバーのカレンダーが追加される
- 各メンバーのカレンダーにチェックが入っている（表示状態）

### テスト4: チーム切り替え

**前提:** 2つ以上のチームが作成済み

**手順:**
1. チームA（例: 3人）を選択
2. Googleカレンダーで3人のカレンダーが表示されることを確認
3. チームB（例: 2人）を選択
4. 同期を待つ
5. Googleカレンダーをリロード

**期待結果:**
- チームAのメンバーカレンダーが非表示になる
- チームBのメンバーカレンダーが表示される
- ヒートマップが更新される

### テスト5: Free/Busy表示

**手順:**
1. チームを選択
2. 「今週」ボタンをクリック
3. ヒートマップが表示されることを確認
4. スロット粒度を変更（15分 → 30分 → 60分）

**期待結果:**
- 各時間帯の空き状況が色分けされる
- 粒度を変更すると表示が更新される
- アクセスできないメンバーがいる場合、警告が表示される

### テスト6: レスポンシブ対応

**手順:**
1. サイドパネルの幅を変更
2. ピル型ボタンが横スクロールすることを確認
3. モバイルサイズ（320px程度）でも表示が崩れないことを確認

**期待結果:**
- 狭い画面でも要素が重ならない
- 横スクロールが機能する
- ボタンのサイズが適切に調整される

## エラーケースのテスト

### テスト7: 存在しないメールアドレス

**手順:**
1. チームに存在しないメールアドレスを追加
   ```
   nonexistent@example.com,存在しないユーザー
   ```
2. チームを選択
3. 同期を待つ

**期待結果:**
- 「X人のカレンダーにアクセスできません」警告が表示される
- 他のメンバーのカレンダーは正常に表示される
- アプリがクラッシュしない

### テスト8: 権限のないカレンダー

**手順:**
1. カレンダーを公開していないユーザーを追加
2. チームを選択

**期待結果:**
- アクセス情報に表示される
- Free/Busy情報が取得できない旨が表示される
- エラーメッセージが適切に表示される

### テスト9: ネットワークエラー

**手順:**
1. Chrome DevToolsを開く
2. Networkタブで「Offline」に設定
3. チームを切り替える

**期待結果:**
- エラーメッセージが表示される
- アプリがクラッシュしない
- ネットワーク復帰後、再試行できる

## パフォーマンステスト

### テスト10: 大量メンバー

**手順:**
1. 20-30人のメンバーを持つチームを作成
2. チームを選択
3. 同期時間を測定

**期待結果:**
- 同期が10-15秒以内に完了
- UIがフリーズしない
- 進行状況が表示される

### テスト11: 頻繁な切り替え

**手順:**
1. チームAとチームBを交互に5回切り替える
2. レスポンス時間を確認

**期待結果:**
- 各切り替えが5秒以内
- メモリリークがない
- UIが反応し続ける

## デバッグ方法

### ログの確認
1. Chrome DevToolsを開く（F12）
2. Consoleタブを確認
3. 以下のログが出力されることを確認：
   ```
   Switching team: [チーム名]
   Hiding calendars: [メールアドレスリスト]
   Showing calendars: [メールアドレスリスト]
   Free/Busy query completed
   ```

### ネットワークリクエストの確認
1. Chrome DevToolsのNetworkタブ
2. Filter: `googleapis.com`
3. 以下のリクエストを確認：
   - `POST /calendar/v3/users/me/calendarList` (カレンダー購読)
   - `PATCH /calendar/v3/users/me/calendarList/{id}` (表示切り替え)
   - `POST /calendar/v3/freeBusy` (Free/Busy取得)

### ストレージの確認
1. Chrome DevToolsのApplicationタブ
2. Storage > Chrome Storage > Sync
3. `teamViews` キーを確認
4. 作成したチームが保存されていることを確認

## よくある問題と解決方法

### 問題1: カレンダーが同期されない

**原因:** 権限が不足している

**解決方法:**
1. `chrome://extensions/` を開く
2. 拡張機能の詳細を表示
3. 「サイト アクセス」を確認
4. 必要に応じて再インストール

### 問題2: 「カレンダーを同期中...」が永遠に続く

**原因:** APIエラーまたはネットワーク問題

**解決方法:**
1. Chrome DevToolsのConsoleでエラーを確認
2. ネットワーク接続を確認
3. 拡張機能をリロード
4. ログアウト/ログインを試す

### 問題3: UIが崩れる

**原因:** CSSファイルが読み込まれていない

**解決方法:**
1. `npm run build` を再実行
2. `dist` フォルダを確認
3. `CompactTeamSelector.css` が存在することを確認
4. 拡張機能をリロード

## 本番環境へのデプロイ前チェックリスト

- [ ] すべてのテストケースがパス
- [ ] エラーハンドリングが適切
- [ ] ログが本番用に調整されている
- [ ] APIキーが環境変数から読み込まれている
- [ ] ユーザードキュメントが更新されている
- [ ] パフォーマンスが許容範囲内
- [ ] セキュリティレビュー完了
- [ ] 権限の説明が明確

## 次のステップ

実装が完了したので、以下の追加機能も検討できます：

1. **カレンダーを開くボタン**: サイドパネルから直接Googleカレンダーを開く
2. **カラーコーディング**: チームごとに異なる色でカレンダーを表示
3. **通知機能**: チーム切り替え完了時の通知
4. **お気に入りチーム**: よく使うチームをピン留め
5. **検索機能**: メンバー名でフィルタリング

---

**重要:** テスト時は実際のGoogleアカウントを使用するため、本番データに影響を与えないよう注意してください。

