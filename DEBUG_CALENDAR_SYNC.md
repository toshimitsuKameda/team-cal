# Googleカレンダー連携のデバッグ手順

## 現在の状況

サイドパネル内にヒートマップが表示されていますが、Googleカレンダーとの連携（メンバーのカレンダーを自動追加）が動作していない可能性があります。

## デバッグ手順

### 1. Chrome DevToolsでログを確認

1. サイドパネルを開く
2. サイドパネル上で右クリック → 「検証」
3. Consoleタブを開く
4. チームをクリックして切り替える

**期待されるログ:**
```
🔄 チーム切り替え開始
新しいチーム: [チーム名] ['email1@example.com', 'email2@example.com']
表示するメンバー: ['email1@example.com', 'email2@example.com']
📅 カレンダーを購読: email1@example.com
✅ カレンダーを購読しました: email1@example.com
📅 カレンダーを購読: email2@example.com
✅ カレンダーを購読しました: email2@example.com
🔄 カレンダーの表示を表示に変更: email1@example.com
✅ カレンダーの表示を変更しました: email1@example.com
🔄 カレンダーの表示を表示に変更: email2@example.com
✅ カレンダーの表示を変更しました: email2@example.com
✅ チーム切り替え完了
```

**ログが出ない場合:**
- チーム切り替えが実行されていない
- または、エラーが発生している

**エラーが表示される場合:**
- エラーメッセージをメモしてください

### 2. Networkタブでリクエストを確認

1. Chrome DevToolsのNetworkタブを開く
2. Filterで「googleapis」と入力
3. チームを切り替える

**期待されるリクエスト:**
- `POST https://www.googleapis.com/calendar/v3/users/me/calendarList`
  - メンバーのカレンダーを購読
- `PATCH https://www.googleapis.com/calendar/v3/users/me/calendarList/{email}`
  - カレンダーの表示/非表示を切り替え

**リクエストが見えない場合:**
- API呼び出しが実行されていない
- または、権限エラーが発生している

### 3. Googleカレンダーで確認

1. 新しいタブで https://calendar.google.com を開く
2. 左側の「他のカレンダー」セクションを確認
3. ページをリロード（F5）

**期待される結果:**
- チームメンバーのメールアドレスがリストに表示される
- チェックボックスがオンになっている

**表示されない場合:**
以下の可能性があります：
1. API呼び出しが失敗している
2. 権限が不足している
3. メールアドレスが間違っている
4. メンバーがカレンダーを共有していない

## よくある問題と解決方法

### 問題1: 403 Forbidden エラー

**原因:** `calendar`スコープが許可されていない

**解決方法:**
1. ヘッダーのログアウトボタンをクリック
2. 再度ログイン
3. 権限許可画面で以下を許可：
   - ✅ カレンダーの表示
   - ✅ カレンダーの編集
   - ✅ カレンダーの共有設定の管理

### 問題2: 404 Not Found エラー

**原因:** メールアドレスが間違っているか、ユーザーが存在しない

**解決方法:**
- メールアドレスのスペルを確認
- 実在するGoogleアカウントのメールアドレスを使用

### 問題3: ログが何も表示されない

**原因:** チーム切り替えが実行されていない

**解決方法:**
- 別のチームをクリック（既に選択されているチームは再度クリックしても何も起こりません）
- チームが1つしかない場合は、別のチームを作成してテスト

### 問題4: カレンダーは追加されるが表示されない

**原因:** カレンダーの共有設定の問題

**解決方法（メンバー側の設定）:**
1. Googleカレンダーを開く
2. 設定 > カレンダーの設定
3. 自分のカレンダーを選択
4. 「特定のユーザーと共有」または「組織で利用できるようにする」を選択
5. 最低限「予定の時間枠のみを表示」を許可

## テスト用のチーム設定

デバッグ用に、以下のような小さいチームを作成してテストしてください：

```
チーム名: テスト
メンバー:
your-own-email@gmail.com,自分
```

自分自身のメールアドレスであれば、確実にカレンダーにアクセスできます。

## 次のステップ

上記の確認を行って、以下の情報を教えてください：

1. **Consoleにログは表示されますか？**
   - はい/いいえ
   - エラーメッセージがあれば全文

2. **Networkタブにリクエストは表示されますか？**
   - はい/いいえ
   - ステータスコード（200, 403, 404など）

3. **Googleカレンダーにメンバーが追加されますか？**
   - はい/いいえ

この情報があれば、問題を特定して修正できます。

