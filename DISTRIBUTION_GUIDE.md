# Chrome拡張機能の組織内配布ガイド

このドキュメントでは、Team Calendar Switcher拡張機能を組織内で配布する方法を説明します。

## 目次

1. [配布方法の比較](#配布方法の比較)
2. [方法1: Chrome Web Store（プライベート配布）](#方法1-chrome-web-storeプライベート配布)
3. [方法2: 手動配布（開発者モード）](#方法2-手動配布開発者モード)
4. [方法3: Google Workspaceポリシー経由](#方法3-google-workspaceポリシー経由)

---

## 配布方法の比較

| 方法 | 推奨度 | メリット | デメリット | 適用シーン |
|------|--------|----------|------------|------------|
| Chrome Web Store（プライベート） | ⭐⭐⭐⭐⭐ | 安全、自動更新、管理しやすい | 初期設定が必要、$5の登録料 | 中〜大規模組織、長期運用 |
| 手動配布（開発者モード） | ⭐⭐ | すぐに配布可能、無料 | 警告表示、手動更新、管理困難 | 小規模組織、テスト配布 |
| Google Workspaceポリシー | ⭐⭐⭐⭐⭐ | 一括配布、強制インストール | Enterprise必須 | Google Workspace Enterprise |

---

## 方法1: Chrome Web Store（プライベート配布）

**最も推奨される方法です。** 組織内のユーザーのみがアクセスできるプライベートリスティングを作成します。

### 前提条件

- Google Workspace組織アカウント
- Chrome Web Store Developer Dashboard登録（$5の一回限りの登録料）

### ステップ1: 拡張機能のパッケージング

1. 本番用にビルド:
```bash
npm run build
```

2. `dist`フォルダの内容をZIPファイルに圧縮:
```bash
cd dist
zip -r ../team-cal-extension.zip .
cd ..
```

### ステップ2: Chrome Web Store Developer Dashboardに登録

1. [Chrome Web Store Developer Dashboard](https://chrome.google.com/webstore/devconsole/)にアクセス
2. Google Workspaceの管理者アカウントでログイン
3. 初回の場合、$5の開発者登録料を支払う

### ステップ3: 拡張機能のアップロード

1. "新しいアイテム"をクリック
2. `team-cal-extension.zip`をアップロード
3. 必要な情報を入力:
   - **名前**: Team Calendar Switcher
   - **説明**: Googleカレンダー上でチームのカレンダーを簡単に切り替えられる拡張機能
   - **カテゴリ**: 生産性
   - **言語**: 日本語
   
4. スクリーンショットをアップロード（推奨サイズ: 1280x800px または 640x400px）
   - メイン画面のスクリーンショット
   - ヒートマップ表示のスクリーンショット
   - チーム切り替え機能のスクリーンショット

5. アイコンを確認（既にmanifest.jsonに含まれています）

### ステップ4: プライベート配布の設定

1. **公開範囲**セクションで「非公開」を選択
2. 配布方法を選択:
   - **信頼できるテスター**: メールアドレスのリストで配布
   - **組織全体**: Google Workspaceドメイン全体に配布

3. **信頼できるテスター**を選択した場合:
   ```
   user1@yourcompany.com
   user2@yourcompany.com
   team-dev@yourcompany.com
   ```
   メールアドレスを1行に1つずつ入力

4. **組織全体**を選択した場合:
   - 組織のドメインを指定: `yourcompany.com`
   - このオプションには組織の確認が必要です

### ステップ5: 審査とリリース

1. "審査のために送信"をクリック
2. 通常、数時間〜数日で審査が完了します
3. 承認されたら、自動的に指定したユーザーがアクセスできるようになります

### ステップ6: ユーザーへの配布

審査が承認されたら、以下の方法でユーザーに通知します:

**配布用URL:**
```
https://chrome.google.com/webstore/detail/[YOUR_EXTENSION_ID]
```

**ユーザー向けインストール手順:**

1. 上記のURLにアクセス
2. "Chromeに追加"ボタンをクリック
3. 権限を確認して"拡張機能を追加"をクリック
4. Googleカレンダーを開いて拡張機能を使用開始

### ステップ7: 更新の配布

拡張機能を更新する場合:

1. `package.json`と`public/manifest.json`のバージョンを更新:
```json
{
  "version": "1.0.1"
}
```

2. ビルドして新しいZIPを作成:
```bash
npm run build
cd dist
zip -r ../team-cal-extension-v1.0.1.zip .
cd ..
```

3. Chrome Web Store Developer Dashboardで"パッケージをアップロード"
4. 審査のために送信
5. ユーザーのブラウザで自動的に更新されます（通常数時間以内）

---

## 方法2: 手動配布（開発者モード）

**小規模な組織やテスト配布に適しています。**

### メリット
- すぐに配布可能
- 費用がかからない
- 審査不要

### デメリット
- セキュリティ警告が表示される
- 各ユーザーが手動でインストール必要
- 自動更新不可
- Chromeの更新で無効化される可能性あり

### ステップ1: 配布用パッケージの作成

1. ビルド:
```bash
npm run build
```

2. `dist`フォルダをZIP圧縮:
```bash
cd dist
zip -r ../team-cal-extension.zip .
cd ..
```

3. ZIPファイルを組織の共有ドライブやファイルサーバーに配置

### ステップ2: インストール手順書の作成

以下の内容でユーザー向けインストール手順を作成します:

```markdown
# Team Calendar拡張機能のインストール手順

## 1. ZIPファイルのダウンロード
共有ドライブから `team-cal-extension.zip` をダウンロードしてください。

## 2. ファイルの解凍
ZIPファイルを任意のフォルダに解凍してください。
例: `C:\Extensions\team-cal-extension\`

## 3. Chromeで拡張機能を読み込む

1. Chromeを開く
2. アドレスバーに `chrome://extensions/` を入力してEnter
3. 右上の**デベロッパーモード**をONにする
4. **パッケージ化されていない拡張機能を読み込む**をクリック
5. 解凍したフォルダを選択
6. 拡張機能が読み込まれます

## 4. 初回設定

1. Googleカレンダーを開く
2. 右上の拡張機能アイコンをクリック
3. 初回はGoogle認証が必要です
4. "許可"をクリックしてカレンダーへのアクセスを許可

## トラブルシューティング

### 「この拡張機能は信頼できません」という警告が表示される
- これは開発者モードでインストールした場合の通常の動作です
- 組織の管理者から配布された拡張機能であれば、安全に使用できます

### 拡張機能が無効化される
- Chromeの更新後に無効化されることがあります
- その場合は `chrome://extensions/` で再度有効化してください
```

### ステップ3: 更新の配布

更新版を配布する場合:

1. 新しいバージョンをビルド
2. 新しいZIPファイルを作成
3. ユーザーに以下の手順を案内:
   - 古いフォルダの内容を削除
   - 新しいZIPを解凍
   - `chrome://extensions/`で拡張機能のリロードボタンをクリック

---

## 方法3: Google Workspaceポリシー経由

**Google Workspace Enterpriseをご利用の場合に最適です。**

### 前提条件

- Google Workspace Enterprise
- 管理者権限

### ステップ1: Chrome Web Storeに公開（方法1と同じ）

プライベート配布として拡張機能を公開します。

### ステップ2: Google Workspace管理コンソールで設定

1. [Google Workspace管理コンソール](https://admin.google.com/)にログイン
2. **デバイス** > **Chrome** > **アプリと拡張機能** > **ユーザーとブラウザ**
3. **追加** > **Chrome Web StoreまたはAndroidアプリからアプリまたは拡張機能を追加**
4. 拡張機能のIDまたはURLを入力
5. 対象の組織単位を選択
6. インストールポリシーを設定:
   - **許可**: ユーザーが任意でインストール可能
   - **強制インストール**: 自動的にインストール
   - **強制インストールして固定**: アンインストール不可

7. **保存**をクリック

### ステップ3: ポリシーの適用確認

- ポリシーが適用されるまで数時間かかる場合があります
- ユーザーがChromeを再起動すると拡張機能が自動的にインストールされます

---

## OAuth設定の更新（重要）

配布前に、OAuth設定を本番用に更新する必要があります。

### Chrome Web Storeで配布する場合

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. プロジェクトを選択
3. **APIとサービス** > **認証情報**
4. OAuth 2.0クライアントIDを編集
5. **承認済みのJavaScriptの生成元**に以下を追加:
   ```
   chrome-extension://[PUBLISHED_EXTENSION_ID]
   ```
   ※ `[PUBLISHED_EXTENSION_ID]`はChrome Web Storeで公開後に取得できるID

6. `public/manifest.json`のClient IDが正しいことを確認
7. 再ビルドして再アップロード

---

## セキュリティとプライバシーの考慮事項

### manifest.jsonの確認

配布前に以下を確認してください:

1. **権限の最小化**: 必要な権限のみ要求していることを確認
```json
"permissions": [
  "identity",
  "storage",
  "tabs"
],
"host_permissions": [
  "https://www.googleapis.com/*",
  "https://calendar.google.com/*"
]
```

2. **OAuth Scopeの確認**: 必要なスコープのみ要求
```json
"oauth2": {
  "scopes": [
    "https://www.googleapis.com/auth/calendar",
    "https://www.googleapis.com/auth/calendar.freebusy",
    "https://www.googleapis.com/auth/userinfo.email"
  ]
}
```

### プライバシーポリシー

Chrome Web Storeで公開する場合、プライバシーポリシーの提供が必要です。
以下のテンプレートを参考にしてください:

```markdown
# プライバシーポリシー

## データの収集と使用

Team Calendar拡張機能は、以下のデータを使用します:

### 収集するデータ
- Googleアカウントのメールアドレス
- Googleカレンダーの空き/予定あり情報
- チーム設定（チーム名、メンバーリスト）

### データの保存場所
- チーム設定: Chromeの同期ストレージ（`chrome.storage.sync`）
- 一時キャッシュ: ブラウザのメモリ（ページリロードで消去）

### データの共有
- 収集したデータは第三者と共有されません
- データは外部サーバーに送信されません
- すべての処理はブラウザ内で完結します

### データの削除
ユーザーはいつでも拡張機能をアンインストールすることでデータを削除できます。

## お問い合わせ
プライバシーに関するご質問は [your-email@yourcompany.com] までご連絡ください。
```

---

## トラブルシューティング

### よくある問題と解決方法

#### 1. 認証エラー

**症状**: 「認証に失敗しました」というエラー

**解決方法**:
- Google Cloud ConsoleのOAuth設定を確認
- 拡張機能IDが正しく登録されているか確認
- Google Calendar APIが有効化されているか確認

#### 2. カレンダーが同期されない

**症状**: チーム切り替え時にカレンダーが表示されない

**解決方法**:
- 対象のカレンダーが共有されているか確認
- カレンダーへのアクセス権限があるか確認
- Googleカレンダーのページをリロード

#### 3. 拡張機能が表示されない

**症状**: 拡張機能アイコンが表示されない

**解決方法**:
- Googleカレンダーのページで拡張機能が有効か確認
- `chrome://extensions/`で拡張機能が有効になっているか確認
- Chromeを再起動

---

## 推奨する配布フロー

### 小規模組織（〜50人）
1. **フェーズ1**: 手動配布でパイロット運用（1-2週間）
2. **フェーズ2**: Chrome Web Storeプライベート配布に移行

### 中〜大規模組織（50人以上）
1. **フェーズ1**: 一部チームで手動配布テスト（1週間）
2. **フェーズ2**: Chrome Web Storeプライベート配布（信頼できるテスター）（2-4週間）
3. **フェーズ3**: 組織全体に展開

### Google Workspace Enterprise
1. **フェーズ1**: Chrome Web Storeプライベート配布
2. **フェーズ2**: Google Workspace管理コンソールで強制インストール設定

---

## チェックリスト

配布前に以下を確認してください:

- [ ] `package.json`と`manifest.json`のバージョンが一致
- [ ] OAuth Client IDが本番用に設定済み
- [ ] Google Calendar APIが有効化済み
- [ ] プライバシーポリシーを作成（Chrome Web Store公開の場合）
- [ ] スクリーンショットを準備（Chrome Web Store公開の場合）
- [ ] インストール手順書を作成
- [ ] サポート連絡先を明記
- [ ] 本番環境でテスト済み

---

## サポートとフィードバック

配布後のサポート体制を整えることをお勧めします:

### サポートチャネル例
- 社内Slackチャネル
- メーリングリスト
- イントラネットのFAQページ
- GitHub Issues（内部リポジトリ）

### フィードバックの収集
- ユーザーアンケートの実施
- 使用状況の分析
- 改善要望の収集

---

## まとめ

**推奨する配布方法:**

1. **すぐに使い始めたい** → 手動配布でスタート
2. **長期的に運用する** → Chrome Web Storeのプライベート配布に移行
3. **Google Workspace Enterprise** → 管理コンソールで一括配布

ご質問やサポートが必要な場合は、開発チームにお問い合わせください。

